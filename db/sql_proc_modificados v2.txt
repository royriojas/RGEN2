



ALTER  PROCEDURE proc_informebasicoReclamoRimac(@ajusteid int)
as

Declare @reclamos int

SELECT  @reclamos = count(*)
FROM    RGN_AJUSTE LEFT OUTER JOIN
              RGN_RECLAMO ON RGN_AJUSTE.ajusteId = RGN_RECLAMO.ajusteId LEFT OUTER JOIN
              RGN_RESERVA ON RGN_AJUSTE.ajusteId = RGN_RESERVA.ajusteId
where RGN_AJUSTE.ajusteid = @ajusteid


if (@reclamos > 1)

begin

	SELECT  
			RGN_AJUSTE.ajusteId,
			isnull(RGN_RECLAMO.monto, 0) AS reclamoasegurado, 
			isnull(RGN_RECLAMO.monedaId,1) as reclamoMonedaId,
			dbo.dameSimboloMoneda(RGN_RECLAMO.monedaId)AS monedaReclamo,
			isnull(RGN_RESERVA.monto,0) AS reservaestimada, 
			isnull(RGN_RESERVA.monedaId,1) AS reservaMonedaId, 
			dbo.dameSimboloMoneda(RGN_RESERVA.monedaId)AS monedaReserva,
			RGN_AJUSTE.situacionajuste, 
			RGN_AJUSTE.notas,
			isnull(RGN_AJUSTE.enviarNumSiniestro, 0) as enviarNumSiniestro,
			isnull(RGN_AJUSTE.enviarCopiaPoliza, 0) as enviarCopiaPoliza
	FROM    RGN_AJUSTE LEFT OUTER JOIN
	              RGN_RECLAMO ON RGN_AJUSTE.ajusteId = RGN_RECLAMO.ajusteId LEFT OUTER JOIN
	              RGN_RESERVA ON RGN_AJUSTE.ajusteId = RGN_RESERVA.ajusteId
	
	where RGN_AJUSTE.ajusteid = @ajusteid AND
	     RGN_RECLAMO.reclamoId= (select max(reclamoId) from RGN_RECLAMO where RGN_RECLAMO.ajusteId=@ajusteId) and
	     RGN_RESERVA.reservaId= (select max(reservaId) from RGN_RESERVA where RGN_RESERVA.ajusteId=@ajusteId)	

END

ELSE

BEGIN

	SELECT  
			RGN_AJUSTE.ajusteId,
			isnull(RGN_RECLAMO.monto, 0) AS reclamoasegurado, 
			isnull(RGN_RECLAMO.monedaId,1) as reclamoMonedaId,
			dbo.dameSimboloMoneda(RGN_RECLAMO.monedaId)AS monedaReclamo,
			isnull(RGN_RESERVA.monto,0) AS reservaestimada, 
			isnull(RGN_RESERVA.monedaId,1) AS reservaMonedaId, 
			dbo.dameSimboloMoneda(RGN_RESERVA.monedaId)AS monedaReserva,
			RGN_AJUSTE.situacionajuste, 
			RGN_AJUSTE.notas,
			isnull(RGN_AJUSTE.enviarNumSiniestro, 0) as enviarNumSiniestro,
			isnull(RGN_AJUSTE.enviarCopiaPoliza, 0) as enviarCopiaPoliza
	FROM    RGN_AJUSTE LEFT OUTER JOIN
	              RGN_RECLAMO ON RGN_AJUSTE.ajusteId = RGN_RECLAMO.ajusteId LEFT OUTER JOIN
	              RGN_RESERVA ON RGN_AJUSTE.ajusteId = RGN_RESERVA.ajusteId
	
	where RGN_AJUSTE.ajusteid = @ajusteid

END
