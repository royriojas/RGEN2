
ALTER PROCEDURE [dbo].[proc_informacionAjusteRimacUpdate]
(
	@ajusteId numeric(8, 0),-- ajuste
	@descripcionRiesgo text = null, 
	@observaciones text = null, 
	@numAjustePASA varchar(30), 
	@causasiniestro text = null, 
    @detalleocurrencia text = null, 
	@situacionajuste text = null, 
	@verificaciongarantias text = null, 
    @siniestrosanteriores text = null,
	@salvamentoyrecupero text = null,
	@recomendaciones text = null,
    @investigaciones text = null,
	@TotalIndenmizacion numeric (14,2)= null,
	@opinionAjustador text = null,
    @descripcionLugarSiniestro text = null,
	@descripcionBienesAfectados text = null,
	@antecedentes text = null,
    @descripcionReclamo text = null,
	@descripcionReserva text = null,
	@materiaAsegurada text = null,
    @localAsegurado text = null,
	@seccion text = null



)
AS
BEGIN
	
	SET NOCOUNT OFF;
	UPDATE [RGN_AJUSTE] 
	SET 	
      descripcionRiesgo = @descripcionRiesgo, 
	  observaciones = @observaciones, 
	  numAjustePASA = @numAjustePASA, 
	  causasiniestro = @causasiniestro, 
      detalleocurrencia = @detalleocurrencia, 
	  situacionajuste =@situacionajuste, 
	  verificaciongarantias = @verificaciongarantias, 
      siniestrosanteriores = @siniestrosanteriores, 
	  salvamentoyrecupero = @salvamentoyrecupero, 
	  recomendaciones =@recomendaciones, 
      investigaciones = @investigaciones, 
	  TotalIndenmizacion = @TotalIndenmizacion, 
	  opinionAjustador = @opinionAjustador, 
      descripcionLugarSiniestro = @descripcionLugarSiniestro, 
	  descripcionBienesAfectados = @descripcionBienesAfectados, 
	  antecedentes = @antecedentes, 
      descripcionReclamo = @descripcionReclamo, 
	  descripcionReserva = @descripcionReserva,
	  materiaAsegurada = @materiaAsegurada, 
      localAsegurado = @localAsegurado, 
	  seccion = @seccion
	WHERE (RGN_AJUSTE.ajusteId=@ajusteId)

END



------------------------------------------------------------------------


ALTER PROCEDURE [dbo].[proc_informacionAjusteRimac]
(
	@ajusteId decimal(8,0)
)
AS
	
BEGIN

SELECT     
	  dbo.RGN_AJUSTE.ajusteId,
	  dbo.RGN_AJUSTE.descripcionRiesgo, 
	  dbo.RGN_AJUSTE.observaciones, 
	  dbo.RGN_AJUSTE.numAjustePASA, 
	  dbo.RGN_AJUSTE.causasiniestro, 
      dbo.RGN_AJUSTE.detalleocurrencia, 
	  dbo.RGN_AJUSTE.situacionajuste, 
	  dbo.RGN_AJUSTE.verificaciongarantias, 
      dbo.RGN_AJUSTE.siniestrosanteriores, 
	  dbo.RGN_AJUSTE.salvamentoyrecupero, 
	  dbo.RGN_AJUSTE.recomendaciones, 
      dbo.RGN_AJUSTE.investigaciones, 
	  dbo.RGN_AJUSTE.TotalIndenmizacion, 
	  dbo.RGN_AJUSTE.opinionAjustador, 
      dbo.RGN_AJUSTE.descripcionLugarSiniestro, 
	  dbo.RGN_AJUSTE.descripcionBienesAfectados, 
	  dbo.RGN_AJUSTE.antecedentes, 
      dbo.RGN_AJUSTE.descripcionReclamo, 
	  dbo.RGN_AJUSTE.descripcionReserva, 
	  dbo.RGN_AJUSTE.materiaAsegurada, 
      dbo.RGN_AJUSTE.localAsegurado, 
	  dbo.RGN_AJUSTE.seccion
FROM         dbo.RGN_AJUSTE 

WHERE RGN_AJUSTE.ajusteId = @ajusteId

END

---------------------------------------------------------------------


alter table rgn_ajuste
  add materiaAsegurada text null 


alter table rgn_ajuste
  add seccion text null

alter table rgn_ajuste
  add localAsegurado text null



28-02-2010
------------------------------------------------------------------------


alter table rgn_convenioajuste
  add fRecepcionConvenioFirmado datetime null


------------------------------------------------------------------------

CREATE PROCEDURE [dbo].[sp_rgen_ConvenioAjusteRimac]
	@ajusteId numeric
AS
BEGIN

	SET NOCOUNT OFF
	DECLARE @Err int

-- sacamos primero la moneda con la cual se esta trabajando los montos

	DECLARE @reserva numeric
	DECLARE @monedaId numeric
	DECLARE @simboloMonedaReserva varchar(3)
	
	SET @reserva = dbo.UltimoEstimadoReservaAjuste(@ajusteid)
	SET @monedaId =dbo.UltimaMonedaReservaAjuste(@ajusteId)
	SET @simboloMonedaReserva = dbo.dameSimboloMoneda(@monedaId)
		
	SELECT	
		RGN_AJUSTE.ajusteId,
		RGN_CONVENIOAJUSTE.totalDeducible,
		RGN_CONVENIOAJUSTE.totalIndemnizacion,
		RGN_CONVENIOAJUSTE.totalPerdida,
		RGN_CONVENIOAJUSTE.montoIndemnizacion,
		RGN_CONVENIOAJUSTE.representante,
		RGN_CONVENIOAJUSTE.fconvenio,
		RGN_CONVENIOAJUSTE.fRecepcionConvenioFirmado,
		RGN_CONVENIOAJUSTE.fcrea,
		RGN_CONVENIOAJUSTE.fupdate,
		RGN_CONVENIOAJUSTE.ucrea,
		RGN_CONVENIOAJUSTE.uupdate,
		@monedaId as monedaId,
		@simboloMonedaReserva as simbolo
		
	FROM 	RGN_AJUSTE LEFT OUTER JOIN 
		RGN_CONVENIOAJUSTE ON RGN_CONVENIOAJUSTE.ajusteId = RGN_AJUSTE.ajusteId
	WHERE	RGN_AJUSTE.ajusteId = @ajusteId

	SET @Err = @@Error

	RETURN @Err
END



CREATE PROCEDURE [dbo].[sp_rgen_EmisionInformesRimac]
	@ajusteId numeric
AS
BEGIN

	SET NOCOUNT OFF
	DECLARE @Err int



	SELECT	*
		
	FROM 	RGN_AJUSTE LEFT OUTER JOIN 
		RGN_INFORME ON RGN_INFORME.ajusteId = RGN_AJUSTE.ajusteId
	WHERE	RGN_AJUSTE.ajusteId = @ajusteId and RGN_INFORME.estado = 'A'

	SET @Err = @@Error

	RETURN @Err
END


---------------------------------------------------------------------------------

CREATE PROCEDURE [dbo].[sp_rgen_SublimitesAfectados] (@ajusteid int)
AS

BEGIN
	SELECT     
		--RGN_ITEMASEGURADO.itemAseguradosId AS item, 
		RGN_ITEMASEGURADO.nombreItem AS detalle, 
		ADM_MONEDA.simbolo AS simbolo, 
		CASE 
		   WHEN RGN_ITEMASEGURADO.concepto = 'Ninguno' THEN ''
		   ELSE RGN_ITEMASEGURADO.concepto
		END as concepto,
		RGN_ITEMASEGURADO.montoAsegurado AS monto,
		CASE 
		   WHEN RGN_ITEMASEGURADO.concepto2 = 'Ninguno' THEN ''
		   ELSE RGN_ITEMASEGURADO.concepto2	
		END as concepto2,
		RGN_ITEMASEGURADO.montoAsegurado2,
		RGN_ITEMASEGURADO.localItem
	FROM		RGN_ITEMASEGURADO_AJUSTE INNER JOIN
          RGN_ITEMASEGURADO ON 
          RGN_ITEMASEGURADO_AJUSTE.itemAseguradosId = RGN_ITEMASEGURADO.itemAseguradosId AND 
          RGN_ITEMASEGURADO_AJUSTE.polizaId = RGN_ITEMASEGURADO.polizaId AND 
          RGN_ITEMASEGURADO_AJUSTE.aseguradoraId = RGN_ITEMASEGURADO.aseguradoraId INNER JOIN
          ADM_MONEDA ON RGN_ITEMASEGURADO.monedaId = ADM_MONEDA.monedaId
	where 	RGN_ITEMASEGURADO_AJUSTE.ajusteid = @ajusteid 
	
END


